---
title: "Osa data exploration"
output:
  html_document:
    toc: yes
    df_print: paged
  html_notebook:
    toc: yes
    code_folding: hide
    theme: spacelab
    fig_caption: yes
editor_options:
  chunk_output_type: console
---

```{r setup}
knitr::opts_chunk$set(
  echo = F,
  message = F,
  warning = F,
  collapse = T
  )
library(here)
source(
  here("analysis/statsTbl.R")
  )
```

# Results

## Shade, biomass, *diversity*

```{r get}
mainModel <- median ~ dist
plotResultsTbl <- plotVarsTbl %>%
  getStatsTbl(
    mainModel
  )
```


```{r table}
plotSignifTbl <- plotResultsTbl %>%
  select(
    variable,
    isSignif,
    isSignif1,
    graph
  ) %>%
  filter(
    isSignif == T |
      isSignif1 == T
  )
plotSignifTbl
```

```{r plots}
plotSignifTbl %>%
  pull(
    graph
    )
#buggyLabel
#ggarrange(.[[1]], .[[2]]) #buggy
```


-   spg et al. vars at tree or plot level? i think plot level.
-   richness, entropy [+spg] signif
- but why reverse relationships from each other?

- higher medians below

```{r get1}
plotResultsTbl1 <- plotVarsTbl %>%
  getStatsTbl1(
    mainModel
  )
```


```{r table1}
plotSignifTbl1 <- plotResultsTbl1 %>%
  select(
    variable,
    isSignif,
    isSignif1,
    graph
  ) %>%
  filter(
    isSignif == T |
      isSignif1 == T
  )
plotSignifTbl1
```

```{r plots}
plotSignifTbl1 %>%
  pull(
    graph
    )
```

- check curves





## Composition


```{r ordination}
ordStat

ordVarTbl <- getOrdVarTbl(
  commTbl,
  metaTbl
)
```

```{r ordigraph}
ordVarTbl %>%
  ggplot(
    aes(
      x = PC1,
      y = PC2,
      color = as_factor(
        dist
      )
    )
  ) +
  geom_point() +
  stat_ellipse()

#library(ggvegan)
```

- which species cause this diff?


```{r taxa}
# plan:
# - nest original data tbl by genus
# - varData = dist & count
# - run env::getStatsTbl()
```



# Appendix

- check curved relationships below

```{r get2}
mainModel2 <- median ~ poly(
  dist,
  2
  )
plotResultsTbl2 <- plotVarsTbl %>%
  getStatsTbl2(
  mainModel2
) %>%
  addStatGraph2(
    mainModel
  )
```

```{r table2}
plotSignifTbl2 <- plotResultsTbl2 %>%
  select(
    variable,
    curve,
    pvals,
    isSignif2,
    graph2
  ) %>%
  unnest(
    c(
      curve,
      pvals,
      isSignif2
    )
  ) %>%
  filter(
    isSignif2 == T
  )
plotSignifTbl2
```

```{r plots2}
plotSignifTbl2 %>%
  pull(
    #buggylabel
    graph2
  )
```


-   spg appears signif--explanation will be relevant
-   explore historgrams for non-sig vars? (i.e. non-equilibrium stats)


# Discussion

-   spg and richness change likely reflects shift in community (--\> add NMDS/PCoA, with closer plots dominated by pioneering species in dense stands
-   i think inference about dispersal strategies could be in discussion, or later figure, no need to be oriiginally embedded in analysis -- but would probably make story more ecological, and study more unique to present, though
