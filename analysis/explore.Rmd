---
title: "Osa data exploration"
output:
  html_notebook:
    toc: yes
    code_folding: hide
    theme: spacelab
    fig_caption: yes
---

```{r setup}
library(knitr); opts_chunk$set(echo=F, include=F)
library(here); source(here("analysis/stats.R"))
library(ggbeeswarm) #quasirandom()
library(ggpmisc) #stat_poly_eq()
library(ggpubr) #ggarrange()
```

```{r data}
plotVarsTbl; plotVarsTbl$vardata
```

# Results

## Shade and slope

```{r stats}
plotVarsStatTbl <- plotVarsTbl %>%
  mutate(statTest = map(.x = vardata,
                        .f = ~ .x %>%
                        lm(formula = median ~ dist))) %>%
  mutate(normality = map(.x = statTest, #needstatcol1st
                         .f = ~ .x %>% residuals() %>% shapiro_test()),
         variance = map(.x = vardata, #originaldata
                        .f = ~ .x %>%
                          levene_test(formula = median ~ as.factor(dist))),
         statVals = map(.x = statTest, #formatsumlast
                        .f = ~ .x %>% summary())) %>%
  mutate(signif = map(.x = statVals,
                      .f = ~ if_else(condition = .x$coefficients[[8]] < 0.05, #p
                                     true = T, false = F))) %>%
                                     unnest(cols = signif)
plotVarsStatTbl
```

```{r graphs}
plotVarsGraphTbl <- plotVarsStatTbl %>%
  mutate(graph = map(.x = vardata,
                     .f = ~ .x %>%
                       ggplot(aes(x = dist, y = median)) +
                       geom_quasirandom() +
                       geom_smooth(method = "lm") +
                       stat_poly_eq(formula = y ~ x, parse = T,
                                    aes(label = stat(..p.value.label..)))))
plotVarsGraphTbl$graph #%>% ggarrange(.[[1]], .[[2]]) #buggy
```

## Edge effects

```{r biomass}

```
