---
title: "Osa data exploration"
output:
  html_document:
    toc: yes
    df_print: paged
  html_notebook:
    toc: yes
    code_folding: hide
    theme: spacelab
    fig_caption: yes
editor_options:
  chunk_output_type: console
---

```{r setup, echo = F, message = F, warning = F, results = 'hide'}
knitr::opts_chunk$set(
  echo = F,
  message = F,
  warning = F
)
library(here)
#.GlobalEnv::
source(
  here("analysis/stats.R")
)
```


# Results

## Shade, biomass, *diversity*

```{r table}
plotSignifTbl <- plotResultsTbl %>%
  select(
    variable,
    isSignif,
    isSignif9,
    R2adj,
    graph
  ) %>%
  filter(
    isSignif == T |
      isSignif9 == T
  )
plotSignifTbl
```

```{r plots}
plotSignifTbl %>%
  pull(
    graph
  )
#buggyLabel
#ggarrange(.[[1]], .[[2]]) #buggy
```

-   spg et al. vars at tree or plot level? i think plot level.

-   richness, entropy [+spg] signif

-   but why reverse relationships from each other?

-   check curve below

```{r table2}
plotSignifTbl2 <- plotResultsTbl2 %>%
  select(
    variable,
    curveName,
    pval,
    R2adj,
    isSignif2,
    graph2
  ) %>%
  unnest(
    c(
      curveName,
      pval,
      isSignif2
    )
  ) %>%
  filter(
    isSignif2 == T
  )
plotSignifTbl2
```

```{r plots2}
plotSignifTbl2 %>%
  pull(
    #buggylabel
    graph2
  )
```

-   higher medians below

```{r table1}
plotSignifTbl1 <- plotResultsTbl1 %>%
  select(
    variable,
    isSignif,
    graph
  ) %>%
  filter(
    isSignif == T
  )
plotSignifTbl1
```

```{r plots1}
plotSignifTbl1 %>%
  pull(
    graph
  )
```

-   check curve below

```{r table12}
plotSignifTbl12 <- plotResultsTbl12 %>%
  select(
    variable,
    curveName,
    pval,
    isSignif2,
    graph2
  ) %>%
  unnest(
    c(
      curveName,
      pval,
      isSignif2
    )
  ) %>%
  filter(
    isSignif2 == T
  )
plotSignifTbl12
```

```{r plots12}
plotSignifTbl12 %>%
  pull(
    #buggylabel
    graph2
  )
```

-   spg appears signif--explanation will be relevant
-   explore historgrams for non-sig vars? (i.e. non-equilibrium stats)


## Composition

```{r ordination}
ordStat

ordVarTbl <- getOrdVarTbl(
  commTbl,
  metaTbl
)
```

```{r ordigraph}
ordVarTbl %>%
  ggplot(
    aes(
      x = PC1,
      y = PC2,
      color = as_factor(
        dist
      )
    )
  ) +
  geom_point() +
  stat_ellipse()

#library(ggvegan)
```

-   which species cause this diff?

```{r getTaxa}
# plan:
# - nest original data tbl by genus
# - varData = dist & count
# - run env::getStatsTbl()
```

```{r tblTaxa}
taxaSignifTbl <- taxaResultsTbl %>%
  select(
    gen,
    isSignif,
    isSignif9,
    R2adj,
    graph
  ) %>%
  filter(
    isSignif == T |
      isSignif9 == T
  )
taxaSignifTbl
```

```{r plotTaxa}
taxaSignifTbl %>%
  pull(
    graph
  )
```

-   check curve below

```{r tblTaxa2}
taxaSignifTbl2 <- taxaResultsTbl2 %>%
  select(
    gen,
    curveName,
    pval,
    R2adj,
    isSignif2,
    graph2
  ) %>%
  unnest(
    c(
      curveName,
      pval,
      isSignif2
    )
  ) %>%
  filter(
    isSignif2 == T
  )
taxaSignifTbl2
```

```{r plotTaxa2}
taxaSignifTbl2 %>%
  pull(
    #buggylabel
    graph2
  )
```

-   higher medians below

```{r tblTaxa1}
taxaSignifTbl1 <- taxaResultsTbl1 %>%
  select(
    gen,
    isSignif,
    graph
  ) %>%
  filter(
    isSignif == T
  )
taxaSignifTbl1
```

```{r plotTaxa1}
taxaSignifTbl1 %>%
  pull(
    graph
  )
```

-   check curve below

```{r tblTaxa12}
taxaSignifTbl12 <- taxaResultsTbl12 %>%
  select(
    gen,
    curveName,
    pval,
    isSignif2,
    graph2
  ) %>%
  unnest(
    c(
      curveName,
      pval,
      isSignif2
    )
  ) %>%
  filter(
    isSignif2 == T
  )
taxaSignifTbl12
```

```{r plotTaxa12}
taxaSignifTbl12 %>%
  pull(
    #buggylabel
    graph2
  )
```


# Discussion

-   spg and richness change likely reflects shift in community (--\> add NMDS/PCoA, with closer plots dominated by pioneering species in dense stands
-   i think inference about dispersal strategies could be in discussion, or later figure, no need to be oriiginally embedded in analysis -- but would probably make story more ecological, and study more unique to present, though

# Appendix + some dependencies

-   check curved relationships below

```{r tryNLS, eval = F}
start <- plotVarsTbl$varData[[1]] %>%
  select(
    mainModel[[3]],
    mainModel[[2]]
  ) %>%
  .[1,]
# nls(
#     formula = mainModel,
#     data = 
#     start = start
#  )
```
